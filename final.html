<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penutup Spesial</title>
    
    

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        body { 
            background-color: #F5F5DC; 
            font-family: 'Arial', sans-serif; 
            text-align: center; 
            padding: 20px; 
            color: #2F4F4F;
            margin: 0;
        }
        .container { 
            max-width: 400px; 
            margin: 20px auto; 
            background: white; 
            padding: 20px; 
            border-radius: 20px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
        }
        h1 { color: #C5A059; font-size: 24px; }
        
        #video-box {
            width: 100%;
            border-radius: 15px;
            overflow: hidden;
            background: #000;
            line-height: 0;
        }
        video, img { width: 100%; height: auto; border-radius: 15px; }
        canvas { display: none; }
        
        textarea {
            width: 100%; 
            padding: 12px; 
            border-radius: 12px; 
            border: 1px solid #ddd;
            margin: 15px 0; 
            font-family: inherit; 
            resize: none; 
            box-sizing: border-box;
        }
        
        .btn {
            padding: 12px 20px; 
            border: none; 
            border-radius: 50px;
            cursor: pointer; 
            font-weight: bold;
            transition: 0.3s;
            width: 100%;
            margin-bottom: 10px;
        }
        .btn-capture { background: #C5A059; color: white; }
        .btn-send { background: #2F4F4F; color: white; display: none; }
        .btn-retake { background: #888; color: white; display: none; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Abadikan Momen ‚ù§Ô∏è</h1>
        <p>Ambil foto ekspresimu dan tulis sesuatu...</p>

        <div id="video-box">
            <video id="video" autoplay playsinline></video>
            <img id="photo-preview" style="display:none;">
        </div>
        
        <canvas id="canvas"></canvas>

        <textarea id="perasaan" placeholder="Gimana perasaanmu hari ini?"></textarea>

        <button id="btn-foto" class="btn btn-capture" onclick="takePhoto()">Ambil Foto üì∏</button>
        <button id="btn-send" class="btn btn-send" onclick="kirimKeDatabase()">Kirim Secara Pribadi üíå</button>
        <button id="btn-retake" class="btn btn-retake" onclick="resetCamera()">Foto Ulang</button>
    </div>

    <script>
        // ==========================================
        // GANTI BAGIAN INI DENGAN KODE FIREBASE KAMU
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyDbTnpzaB4lK8VqIbqcxY320PBy4nISloc",
  authDomain: "fitur-kirim-foto.firebaseapp.com",
  databaseURL: "https://fitur-kirim-foto-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "fitur-kirim-foto",
  storageBucket: "fitur-kirim-foto.firebasestorage.app",
  messagingSenderId: "1023237686167",
  appId: "1:1023237686167:web:3ace2b6573685806273ad2",
        };
        // ==========================================

        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const photoPreview = document.getElementById('photo-preview');
        const btnFoto = document.getElementById('btn-foto');
        const btnSend = document.getElementById('btn-send');
        const btnRetake = document.getElementById('btn-retake');

        // Minta Izin Kamera
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => { video.srcObject = stream; })
            .catch(err => { alert("Izin kamera ditolak!"); });

        function takePhoto() {
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            photoPreview.src = canvas.toDataURL('image/png');
            photoPreview.style.display = 'block';
            video.style.display = 'none';
            
            btnFoto.style.display = 'none';
            btnSend.style.display = 'block';
            btnRetake.style.display = 'block';
        }

        function resetCamera() {
            photoPreview.style.display = 'none';
            video.style.display = 'block';
            btnFoto.style.display = 'block';
            btnSend.style.display = 'none';
            btnRetake.style.display = 'none';
        }

        function kirimKeDatabase() {
            const pesan = document.getElementById('perasaan').value;
            const foto = photoPreview.src;

            if(!pesan) { alert("Tulis pesan dulu ya!"); return; }

            btnSend.innerText = "Mengirim...";
            btnSend.disabled = true;

            database.ref('pesan_si_dia/').push({
                foto: foto,
                perasaan: pesan,
                waktu: new Date().toLocaleString()
            }).then(() => {
                alert("Berhasil terkirim! Terima kasih ya ‚ù§Ô∏è");
                window.location.href = "index.html"; 
            }).catch(err => {
                alert("Gagal kirim: " + err.message);
                btnSend.innerText = "Kirim Secara Pribadi üíå";
                btnSend.disabled = false;
            });
        }
    </script>
</body>
</html>
